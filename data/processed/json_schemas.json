{
  "project": "MoMo SMS Analytics",
  "team": "Codeizzy",
  "version": "1.0",
  "description": "JSON schemas for MoMo SMS transaction data models",
  
  "schemas": {
    "User": {
      "description": "Represents a MoMo user/customer account",
      "type": "object",
      "properties": {
        "user_id": {
          "type": "integer",
          "description": "Unique identifier for the user (Primary Key)",
          "example": 1001
        },
        "phone_number": {
          "type": "string",
          "description": "MoMo registered phone number",
          "pattern": "^\\+250[0-9]{9}$",
          "example": "+250788123456"
        },
        "full_name": {
          "type": "string",
          "description": "Customer's full name",
          "minLength": 2,
          "maxLength": 100,
          "example": "Jean Baptiste Nkurunziza"
        },
        "email": {
          "type": "string",
          "format": "email",
          "description": "User's email address",
          "example": "jean.baptiste@email.com"
        },
        "account_balance": {
          "type": "number",
          "format": "decimal",
          "description": "Current account balance in RWF",
          "minimum": 0,
          "example": 150000.50
        },
        "account_status": {
          "type": "string",
          "enum": ["active", "suspended", "closed"],
          "description": "Current status of the account",
          "example": "active"
        },
        "created_at": {
          "type": "string",
          "format": "date-time",
          "description": "Account creation timestamp",
          "example": "2024-01-15T10:30:00Z"
        },
        "last_transaction_date": {
          "type": "string",
          "format": "date-time",
          "description": "Date of last transaction",
          "example": "2024-01-26T14:20:00Z"
        },
        "kyc_verified": {
          "type": "boolean",
          "description": "Whether KYC verification is complete",
          "example": true
        }
      },
      "required": ["user_id", "phone_number", "full_name", "account_status", "created_at"]
    },

    "Transaction_Category": {
      "description": "Represents transaction categories for MoMo operations",
      "type": "object",
      "properties": {
        "category_id": {
          "type": "integer",
          "description": "Unique identifier for the category (Primary Key)",
          "example": 201
        },
        "category_name": {
          "type": "string",
          "description": "Name of the transaction category",
          "example": "SEND_MONEY"
        },
        "category_type": {
          "type": "string",
          "enum": ["TRANSFER", "PAYMENT", "DEPOSIT", "WITHDRAWAL", "AIRTIME", "UTILITY"],
          "description": "Type classification of the category",
          "example": "TRANSFER"
        },
        "description": {
          "type": "string",
          "description": "Detailed description of the category",
          "example": "Transfer money to another MoMo user"
        },
        "fee_percentage": {
          "type": "number",
          "format": "decimal",
          "description": "Transaction fee percentage",
          "minimum": 0,
          "maximum": 100,
          "example": 1.5
        },
        "fee_flat": {
          "type": "number",
          "format": "decimal",
          "description": "Flat fee amount in RWF",
          "minimum": 0,
          "example": 100
        },
        "color_code": {
          "type": "string",
          "pattern": "^#[0-9A-Fa-f]{6}$",
          "description": "Hex color code for UI representation",
          "example": "#4CAF50"
        },
        "icon": {
          "type": "string",
          "description": "Icon identifier for the category",
          "example": "send_money_icon"
        },
        "is_active": {
          "type": "boolean",
          "description": "Whether the category is currently active",
          "example": true
        }
      },
      "required": ["category_id", "category_name", "category_type", "is_active"]
    },

    "Transaction": {
      "description": "Represents a MoMo SMS transaction record",
      "type": "object",
      "properties": {
        "transaction_id": {
          "type": "integer",
          "description": "Unique identifier for the transaction (Primary Key)",
          "example": 5001
        },
        "user_id": {
          "type": "integer",
          "description": "Foreign Key referencing User",
          "example": 1001
        },
        "category_id": {
          "type": "integer",
          "description": "Foreign Key referencing Transaction_Category",
          "example": 201
        },
        "transaction_type": {
          "type": "string",
          "enum": ["SEND", "RECEIVE", "DEPOSIT", "WITHDRAW", "AIRTIME_PURCHASE", "BILL_PAYMENT"],
          "description": "Type of transaction",
          "example": "SEND"
        },
        "amount": {
          "type": "number",
          "format": "decimal",
          "description": "Transaction amount in RWF",
          "minimum": 0,
          "example": 50000.00
        },
        "transaction_fee": {
          "type": "number",
          "format": "decimal",
          "description": "Fee charged for the transaction in RWF",
          "minimum": 0,
          "example": 750.00
        },
        "balance_after": {
          "type": "number",
          "format": "decimal",
          "description": "Account balance after transaction in RWF",
          "example": 99250.00
        },
        "transaction_date": {
          "type": "string",
          "format": "date-time",
          "description": "Date and time when transaction occurred",
          "example": "2024-01-25T14:30:00Z"
        },
        "recipient_phone": {
          "type": "string",
          "description": "Recipient's phone number (for transfers)",
          "pattern": "^\\+250[0-9]{9}$",
          "example": "+250788654321"
        },
        "recipient_name": {
          "type": "string",
          "description": "Recipient's name",
          "example": "Marie Claire Uwase"
        },
        "sms_content": {
          "type": "string",
          "description": "Original SMS message content",
          "example": "You have sent RWF 50,000.00 to +250788654321 Marie Claire. Fee RWF 750. Balance RWF 99,250.00"
        },
        "reference_number": {
          "type": "string",
          "description": "Transaction reference/confirmation number",
          "example": "MP240125.1430.A12345"
        },
        "status": {
          "type": "string",
          "enum": ["completed", "pending", "failed", "reversed"],
          "description": "Transaction status",
          "example": "completed"
        },
        "merchant_code": {
          "type": "string",
          "description": "Merchant code for bill payments",
          "example": "REG001"
        },
        "bill_reference": {
          "type": "string",
          "description": "Bill reference number for utility payments",
          "example": "ELEC-2024-001"
        },
        "notes": {
          "type": "string",
          "description": "Additional notes or comments",
          "example": "Monthly rent payment"
        },
        "created_at": {
          "type": "string",
          "format": "date-time",
          "description": "Record creation timestamp",
          "example": "2024-01-25T14:31:00Z"
        },
        "updated_at": {
          "type": "string",
          "format": "date-time",
          "description": "Record last update timestamp",
          "example": "2024-01-25T14:31:00Z"
        }
      },
      "required": ["transaction_id", "user_id", "category_id", "transaction_type", "amount", "transaction_date", "status", "created_at"]
    },

    "System_Log": {
      "description": "Represents system activity and audit logs",
      "type": "object",
      "properties": {
        "log_id": {
          "type": "integer",
          "description": "Unique identifier for the log entry (Primary Key)",
          "example": 9001
        },
        "user_id": {
          "type": "integer",
          "description": "Foreign Key referencing User who performed the action",
          "example": 1001
        },
        "action_type": {
          "type": "string",
          "enum": ["SMS_PARSED", "TRANSACTION_CREATED", "USER_LOGIN", "DATA_EXPORT", "ETL_RUN", "ERROR", "WARNING"],
          "description": "Type of system action logged",
          "example": "SMS_PARSED"
        },
        "entity_type": {
          "type": "string",
          "enum": ["transaction", "user", "category", "sms", "etl_process"],
          "description": "Type of entity affected",
          "example": "transaction"
        },
        "entity_id": {
          "type": "integer",
          "description": "ID of the affected entity",
          "example": 5001
        },
        "timestamp": {
          "type": "string",
          "format": "date-time",
          "description": "When the action occurred",
          "example": "2024-01-25T14:30:00Z"
        },
        "severity": {
          "type": "string",
          "enum": ["INFO", "WARNING", "ERROR", "CRITICAL"],
          "description": "Severity level of the log",
          "example": "INFO"
        },
        "message": {
          "type": "string",
          "description": "Log message description",
          "example": "Successfully parsed SMS and created transaction record"
        },
        "ip_address": {
          "type": "string",
          "format": "ipv4",
          "description": "IP address of the client",
          "example": "192.168.1.100"
        },
        "user_agent": {
          "type": "string",
          "description": "Browser/client information",
          "example": "Mozilla/5.0 (Windows NT 10.0; Win64; x64)..."
        },
        "error_details": {
          "type": "object",
          "description": "Additional error information if applicable",
          "properties": {
            "error_code": {
              "type": "string",
              "example": "ETL_001"
            },
            "error_message": {
              "type": "string",
              "example": "Failed to parse SMS format"
            },
            "stack_trace": {
              "type": "string",
              "example": "line 45 in parse_xml.py"
            }
          }
        },
        "metadata": {
          "type": "object",
          "description": "Additional contextual data",
          "properties": {
            "sms_count": {
              "type": "integer",
              "example": 150
            },
            "processing_time_ms": {
              "type": "integer",
              "example": 234
            },
            "source_file": {
              "type": "string",
              "example": "momo.xml"
            }
          }
        }
      },
      "required": ["log_id", "action_type", "entity_type", "timestamp", "severity", "message"]
    }
  },

  "examples": {
    "complex_nested_transaction": {
      "transaction_id": 5025,
      "user_id": 1001,
      "category_id": 201,
      "transaction_type": "SEND",
      "amount": 50000.00,
      "transaction_fee": 750.00,
      "balance_after": 99250.00,
      "transaction_date": "2024-01-25T14:30:00Z",
      "recipient_phone": "+250788654321",
      "recipient_name": "Marie Claire Uwase",
      "sms_content": "You have sent RWF 50,000.00 to +250788654321 Marie Claire. Fee RWF 750. Balance RWF 99,250.00",
      "reference_number": "MP240125.1430.A12345",
      "status": "completed",
      "notes": "Monthly rent payment to landlord",
      
      "user": {
        "user_id": 1001,
        "phone_number": "+250788123456",
        "full_name": "Jean Baptiste Nkurunziza",
        "email": "jean.baptiste@email.com",
        "account_balance": 99250.00,
        "account_status": "active"
      },
      
      "category": {
        "category_id": 201,
        "category_name": "SEND_MONEY",
        "category_type": "TRANSFER",
        "description": "Transfer money to another MoMo user",
        "fee_percentage": 1.5,
        "color_code": "#4CAF50",
        "icon": "send_money_icon"
      },
      
      "recipient": {
        "phone_number": "+250788654321",
        "name": "Marie Claire Uwase",
        "relationship": "landlord"
      },
      
      "sms_metadata": {
        "parsed_at": "2024-01-25T14:31:00Z",
        "parsing_method": "xml_etl",
        "confidence_score": 0.98,
        "validation_passed": true
      },
      
      "analytics": {
        "transaction_count_today": 5,
        "total_sent_today": 125000.00,
        "average_transaction_amount": 25000.00,
        "category_frequency": "frequent"
      },
      
      "created_at": "2024-01-25T14:31:00Z",
      "updated_at": "2024-01-25T14:31:00Z"
    },
    
    "bill_payment_transaction": {
      "transaction_id": 5026,
      "user_id": 1001,
      "category_id": 206,
      "transaction_type": "BILL_PAYMENT",
      "amount": 15000.00,
      "transaction_fee": 200.00,
      "balance_after": 84050.00,
      "transaction_date": "2024-01-25T16:45:00Z",
      "merchant_code": "REG001",
      "bill_reference": "ELEC-2024-001",
      "sms_content": "You have paid RWF 15,000.00 to REG for ELEC-2024-001. Fee RWF 200. Balance RWF 84,050.00",
      "reference_number": "MP240125.1645.B67890",
      "status": "completed",
      "notes": "Electricity bill payment",
      
      "category": {
        "category_id": 206,
        "category_name": "UTILITY_PAYMENT",
        "category_type": "UTILITY",
        "description": "Payment for utilities (electricity, water, etc.)",
        "color_code": "#FFC107",
        "icon": "utility_icon"
      },
      
      "created_at": "2024-01-25T16:46:00Z",
      "updated_at": "2024-01-25T16:46:00Z"
    }
  },

  "sql_to_json_mapping": {
    "overview": "Mapping between SQL database tables and JSON API responses for MoMo SMS Analytics",
    
    "Users_table": {
      "sql_columns": [
        "user_id (INT PRIMARY KEY)",
        "phone_number (VARCHAR(15) UNIQUE)",
        "full_name (VARCHAR(100))",
        "email (VARCHAR(100))",
        "account_balance (DECIMAL(12,2))",
        "account_status (ENUM)",
        "created_at (TIMESTAMP)",
        "last_transaction_date (TIMESTAMP)",
        "kyc_verified (BOOLEAN)"
      ],
      "json_structure": "Flat object with direct property mapping",
      "transformations": [
        "phone_number: Stored as VARCHAR, validated with regex pattern in JSON",
        "account_balance: SQL DECIMAL(12,2) → JSON number",
        "account_status: SQL ENUM → JSON string with enum validation",
        "created_at: SQL TIMESTAMP → JSON ISO 8601 string (YYYY-MM-DDTHH:MM:SSZ)",
        "kyc_verified: SQL BOOLEAN/TINYINT → JSON boolean"
      ]
    },
    
    "Transaction_Categories_table": {
      "sql_columns": [
        "category_id (INT PRIMARY KEY)",
        "category_name (VARCHAR(50))",
        "category_type (ENUM)",
        "description (TEXT)",
        "fee_percentage (DECIMAL(5,2))",
        "fee_flat (DECIMAL(10,2))",
        "color_code (VARCHAR(7))",
        "icon (VARCHAR(50))",
        "is_active (BOOLEAN)"
      ],
      "json_structure": "Flat object with direct property mapping",
      "transformations": [
        "category_type: SQL ENUM → JSON string with enum validation",
        "fee_percentage, fee_flat: SQL DECIMAL → JSON number",
        "color_code: Validated with hex color regex pattern",
        "is_active: SQL BOOLEAN → JSON boolean"
      ]
    },
    
    "Transactions_table": {
      "sql_columns": [
        "transaction_id (INT PRIMARY KEY)",
        "user_id (INT FOREIGN KEY)",
        "category_id (INT FOREIGN KEY)",
        "transaction_type (ENUM)",
        "amount (DECIMAL(12,2))",
        "transaction_fee (DECIMAL(10,2))",
        "balance_after (DECIMAL(12,2))",
        "transaction_date (TIMESTAMP)",
        "recipient_phone (VARCHAR(15))",
        "recipient_name (VARCHAR(100))",
        "sms_content (TEXT)",
        "reference_number (VARCHAR(50))",
        "status (ENUM)",
        "merchant_code (VARCHAR(20))",
        "bill_reference (VARCHAR(50))",
        "notes (TEXT)",
        "created_at (TIMESTAMP)",
        "updated_at (TIMESTAMP)"
      ],
      "json_structure": "Can be flat or nested depending on API endpoint needs",
      "transformations": [
        "Basic GET /transactions: Flat structure with foreign key IDs",
        "Detailed GET /transactions/{id}: Nested structure with expanded user and category objects",
        "amount, transaction_fee, balance_after: SQL DECIMAL → JSON number",
        "transaction_date: SQL TIMESTAMP → JSON ISO 8601 string",
        "transaction_type, status: SQL ENUM → JSON string with validation",
        "Foreign keys expanded: user_id and category_id can be replaced with full objects in nested responses"
      ]
    },
    
    "System_Logs_table": {
      "sql_columns": [
        "log_id (INT PRIMARY KEY)",
        "user_id (INT FOREIGN KEY)",
        "action_type (ENUM)",
        "entity_type (VARCHAR(50))",
        "entity_id (INT)",
        "timestamp (TIMESTAMP)",
        "severity (ENUM)",
        "message (TEXT)",
        "ip_address (VARCHAR(45))",
        "user_agent (TEXT)",
        "error_details_json (JSON/TEXT)",
        "metadata_json (JSON/TEXT)"
      ],
      "json_structure": "Nested object with error_details and metadata as embedded objects",
      "transformations": [
        "error_details_json: SQL JSON/TEXT → JSON object with error_code, error_message, stack_trace",
        "metadata_json: SQL JSON/TEXT → JSON object with dynamic properties",
        "timestamp: SQL TIMESTAMP → JSON ISO 8601 string",
        "action_type, severity: SQL ENUM → JSON string",
        "For PostgreSQL: Use JSONB type for better query performance",
        "For MySQL: Use JSON type or TEXT with JSON validation",
        "For SQLite: Store as TEXT and parse/validate in application layer"
      ]
    }
  },

  "api_response_patterns": {
    "list_transactions": {
      "description": "GET /api/transactions - List all transactions (flat structure)",
      "example": {
        "status": "success",
        "count": 2,
        "data": [
          {
            "transaction_id": 5001,
            "user_id": 1001,
            "category_id": 201,
            "amount": 50000.00,
            "transaction_date": "2024-01-25T14:30:00Z",
            "status": "completed"
          }
        ]
      }
    },
    
    "get_transaction_detail": {
      "description": "GET /api/transactions/{id} - Get single transaction (nested structure)",
      "example": {
        "status": "success",
        "data": {
          "transaction_id": 5001,
          "amount": 50000.00,
          "user": {
            "user_id": 1001,
            "phone_number": "+250788123456",
            "full_name": "Jean Baptiste"
          },
          "category": {
            "category_id": 201,
            "category_name": "SEND_MONEY"
          }
        }
      }
    }
  }
}
